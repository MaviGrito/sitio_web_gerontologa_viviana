---
import { generateSEO, generateSchemaOrg, type SEOProps } from '../utils/seo';
import { SITE_CONFIG } from '../utils/constants';
import Footer from '../components/layout/Footer.astro';
import '../styles/global.css';

export interface Props extends SEOProps {
  schemaType?: 'Person' | 'Article' | 'WebSite';
  schemaData?: any;
  class?: string;
}

const {
  title,
  description,
  image,
  url,
  type = 'website',
  publishDate,
  author,
  schemaType = 'WebSite',
  schemaData = {},
  class: className = ''
} = Astro.props;

const seo = generateSEO({
  title,
  description,
  image,
  url,
  type,
  publishDate,
  author
});

const schema = generateSchemaOrg(schemaType, schemaData);
---

<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO Meta Tags -->
    <title>{seo.title}</title>
    <meta name="description" content={seo.description} />
    <meta name="keywords" content={SITE_CONFIG.seo.keywords.join(', ')} />
    <meta name="author" content={SITE_CONFIG.author.name} />
    <link rel="canonical" href={seo.canonical} />
    
    <!-- Open Graph Tags -->
    <meta property="og:type" content={seo.openGraph.type} />
    <meta property="og:title" content={seo.openGraph.title} />
    <meta property="og:description" content={seo.openGraph.description} />
    <meta property="og:url" content={seo.openGraph.url} />
    <meta property="og:image" content={seo.openGraph.image} />
    <meta property="og:site_name" content={seo.openGraph.siteName} />
    <meta property="og:locale" content="es_ES" />
    {seo.openGraph.publishedTime && (
      <meta property="article:published_time" content={seo.openGraph.publishedTime} />
    )}
    {seo.openGraph.author && (
      <meta property="article:author" content={seo.openGraph.author} />
    )}
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content={seo.twitter.card} />
    <meta name="twitter:title" content={seo.twitter.title} />
    <meta name="twitter:description" content={seo.twitter.description} />
    <meta name="twitter:image" content={seo.twitter.image} />
    <meta name="twitter:creator" content={seo.twitter.creator} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <link rel="apple-touch-icon" href="/favicon.svg?v=2" />
    <!-- Fallback for older browsers -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2" />
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Fonts -->
    <link 
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" 
      rel="stylesheet" 
    />
    <link 
      href="https://fonts.googleapis.com/css2?family=More+Sugar&display=swap" 
      rel="stylesheet" 
    />
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    
    <!-- Accessibility and Performance -->
    <meta name="theme-color" content="#136038" />
    <meta name="color-scheme" content="light" />
    
    <!-- Robots and Indexing -->
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />
    
    <!-- Additional Meta Tags for Medical Website -->
    <meta name="format-detection" content="telephone=yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content={SITE_CONFIG.title} />
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- Import Global Styles -->
    <!-- Global styles are imported in the frontmatter -->
  </head>
  
  <body class={`min-h-screen bg-white text-primary-dark antialiased ${className}`}>
    <!-- Skip to main content for screen readers -->
    <a 
      href="#main-content" 
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white px-4 py-2 rounded-md z-50"
    >
      Saltar al contenido principal
    </a>
    
    <!-- Main content wrapper -->
    <div id="main-content" class="flex flex-col min-h-screen">
      <slot />
      <Footer />
    </div>
    
    <!-- Structured Data for Medical Organization -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "MedicalOrganization",
      "name": SITE_CONFIG.title,
      "description": SITE_CONFIG.description,
      "url": "https://your-domain.com",
      "telephone": SITE_CONFIG.contact.phone,
      "email": SITE_CONFIG.contact.email,
      "address": {
        "@type": "PostalAddress",
        "streetAddress": SITE_CONFIG.contact.address
      },
      "sameAs": [
        SITE_CONFIG.social.instagram,
        SITE_CONFIG.social.facebook,
        SITE_CONFIG.social.linkedin
      ],
      "medicalSpecialty": "Gerontology",
      "founder": {
        "@type": "Person",
        "name": SITE_CONFIG.author.name,
        "jobTitle": SITE_CONFIG.author.title
      }
    })} />
    
    <!-- Netlify Identity Initialization -->
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
</html>