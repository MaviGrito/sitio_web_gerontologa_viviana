---
export interface Props {
  images: string[];
  title: string;
}

const { images, title } = Astro.props;

// If no images or only one image, don't show gallery
if (!images || images.length <= 1) {
  return null;
}
---

<div class="image-gallery mt-8 mb-8">
  <h3 class="text-xl font-heading font-bold text-primary-dark mb-4">
    Galería de Imágenes
  </h3>
  
  <div class="gallery-container relative bg-gray-100 rounded-2xl overflow-hidden">
    <!-- Gallery Images -->
    <div class="gallery-track flex transition-transform duration-300 ease-in-out" id="gallery-track">
      {images.map((image, index) => (
        <div class="gallery-slide flex-shrink-0 w-full">
          <div class="aspect-video bg-white flex items-center justify-center p-4">
            <img
              src={image}
              alt={`${title} - Imagen ${index + 1}`}
              class="max-w-full max-h-full object-contain rounded-lg shadow-sm"
              loading="lazy"
            />
          </div>
        </div>
      ))}
    </div>
    
    <!-- Navigation Buttons -->
    {images.length > 1 && (
      <>
        <button
          class="gallery-btn gallery-btn-prev absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-gray-800 rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Imagen anterior"
          id="gallery-prev"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        
        <button
          class="gallery-btn gallery-btn-next absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-gray-800 rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Siguiente imagen"
          id="gallery-next"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </>
    )}
    
    <!-- Indicators -->
    {images.length > 1 && (
      <div class="gallery-indicators absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
        {images.map((_, index) => (
          <button
            class="gallery-indicator w-3 h-3 rounded-full bg-white/60 hover:bg-white/80 transition-colors duration-200"
            data-index={index}
            aria-label={`Ir a imagen ${index + 1}`}
          />
        ))}
      </div>
    )}
  </div>
  
  <!-- Image Counter -->
  {images.length > 1 && (
    <div class="gallery-counter text-center mt-3 text-sm text-gray-600">
      <span id="current-image">1</span> de {images.length} imágenes
    </div>
  )}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const track = document.getElementById('gallery-track');
    const prevBtn = document.getElementById('gallery-prev');
    const nextBtn = document.getElementById('gallery-next');
    const indicators = document.querySelectorAll('.gallery-indicator');
    const currentImageSpan = document.getElementById('current-image');
    
    if (!track || !prevBtn || !nextBtn) return;
    
    let currentIndex = 0;
    const totalImages = indicators.length;
    
    function updateGallery() {
      // Move track
      const translateX = -currentIndex * 100;
      track.style.transform = `translateX(${translateX}%)`;
      
      // Update indicators
      indicators.forEach((indicator, index) => {
        if (index === currentIndex) {
          indicator.classList.add('bg-white');
          indicator.classList.remove('bg-white/60');
        } else {
          indicator.classList.add('bg-white/60');
          indicator.classList.remove('bg-white');
        }
      });
      
      // Update counter
      if (currentImageSpan) {
        currentImageSpan.textContent = (currentIndex + 1).toString();
      }
      
      // Update button states
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === totalImages - 1;
    }
    
    // Previous button
    prevBtn.addEventListener('click', function() {
      if (currentIndex > 0) {
        currentIndex--;
        updateGallery();
      }
    });
    
    // Next button
    nextBtn.addEventListener('click', function() {
      if (currentIndex < totalImages - 1) {
        currentIndex++;
        updateGallery();
      }
    });
    
    // Indicator buttons
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', function() {
        currentIndex = index;
        updateGallery();
      });
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowLeft' && currentIndex > 0) {
        currentIndex--;
        updateGallery();
      } else if (e.key === 'ArrowRight' && currentIndex < totalImages - 1) {
        currentIndex++;
        updateGallery();
      }
    });
    
    // Touch/swipe support
    let startX = 0;
    let endX = 0;
    
    track.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
    });
    
    track.addEventListener('touchend', function(e) {
      endX = e.changedTouches[0].clientX;
      const diff = startX - endX;
      
      if (Math.abs(diff) > 50) { // Minimum swipe distance
        if (diff > 0 && currentIndex < totalImages - 1) {
          // Swipe left - next image
          currentIndex++;
          updateGallery();
        } else if (diff < 0 && currentIndex > 0) {
          // Swipe right - previous image
          currentIndex--;
          updateGallery();
        }
      }
    });
    
    // Initialize
    updateGallery();
  });
</script>

<style>
  .gallery-container {
    min-height: 400px;
  }
  
  .gallery-track {
    width: calc(100% * var(--total-images, 1));
  }
  
  .gallery-slide {
    width: calc(100% / var(--total-images, 1));
  }
  
  .gallery-btn:hover {
    transform: translateY(-50%) scale(1.1);
  }
  
  .gallery-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: translateY(-50%) scale(1);
  }
  
  .gallery-indicator.active {
    background-color: white;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .gallery-btn {
      padding: 8px;
    }
    
    .gallery-btn svg {
      width: 16px;
      height: 16px;
    }
    
    .gallery-indicators {
      bottom: 12px;
    }
    
    .gallery-indicator {
      width: 8px;
      height: 8px;
    }
  }
</style>